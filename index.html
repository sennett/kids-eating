<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width">
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            height: 100%;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>
        var DEFAULT_ZOOM = 12
        var DEFAULT_CENTRE = {
            lat: 41.3937221351275,
            lng: 2.158396155313767
        }

        var centre = localStorage.getItem('mapCentreLat') ? {
            lat: Number(localStorage.getItem('mapCentreLat')),
            lng: Number(localStorage.getItem('mapCentreLng'))
        } : DEFAULT_CENTRE

        var zoom = localStorage.getItem('mapZoom') ? Number(localStorage.getItem('mapZoom')) : DEFAULT_ZOOM

        var restaurants = [{
            name: "Restaurant Singular",
            address: "Carrer de Sardenya, 321, 08025 Barcelona",
            lat: 41.403922,
            lng: 2.172328
            // highchairs, alcholo, playarea, food, cafe/restaurant, space, changing mat 💺🎲☕🥐🍷🍽️💩
        }, {
            name: "The Pudding Bar",
            address: "Carrer de Pau Claris, 90, 08010 Barcelona",
            lat: 41.390185,
            lng: 2.140709
        }, {
            name: "Pudding Coffee Shop",
            address: "Avinguda Diagonal, 515, 08029 Barcelona",
            lat: 41.391311,
            lng: 2.172328
        }, {
            name: "Family Room Cafe",
            address: "Carrer de Joan Gamper, 13, 08014 Barcelona",
            lat: 41.387115,
            lng: 2.133945
        }, {
            name: "+ Calida:d Fleca i degustació",
            address: "Carrer del Rosselló, 360, 08025 Barcelona",
            lat: 41.403563,
            lng: 2.171249
        }, {
            name: "El Señorio del Perú",
            address: "Carrer de Còrsega, 607, 08025 Barcelona",
            lat: 41.408517,
            lng: 2.175085
        }, {
            name: "Doble Zer00 Restaurant",
            address: "Carrer de Jaume Giralt, 53, 08003 Barcelona",
            lat: 41.387935,
            lng: 2.178699
        }]

        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: zoom,
                center: centre,
                styles: [
                    {
                        "featureType": "poi.business",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "road",
                        "elementType": "labels.icon",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "transit",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    }
                ]
            });

            var infowindow = new google.maps.InfoWindow({
                maxWidth: map.getDiv().clientWidth * 2/3 // google maps doesn't seem to like this width too much 😎
            })
            
            restaurants.forEach(function (restaurant) {
                var marker = new google.maps.Marker({
                    position: restaurant,
                    map: map
                })

                marker.addListener('click', function () {
                    infowindow.close()
                    infowindow.setContent(`<h1>${restaurant.name}</h1>`)
                    infowindow.open(map, marker)
                })
            })

            map.addListener('center_changed', function () {
                var latLng = map.getCenter()
                localStorage.setItem('mapCentreLat', latLng.lat())
                localStorage.setItem('mapCentreLng', latLng.lng())
            })

            map.addListener('zoom_changed', function () {
                localStorage.setItem('mapZoom', map.getZoom())
            })
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAR9P_UyRtqQdYBlx6IZkju8jSgO8iWzk4&callback=initMap">
    </script>
</body>

</html>